'use strict';var TextLayerBuilder=function textLayerBuilder(a){var b=document.createDocumentFragment();this.textLayerDiv=a.textLayerDiv;this.layoutDone=false;this.divContentDone=false;this.pageIdx=a.pageIndex;this.matches=[];this.lastScrollSource=a.lastScrollSource;this.viewport=a.viewport;this.isViewerInPresentationMode=a.isViewerInPresentationMode;if(typeof PDFFindController==='undefined')window.PDFFindController=null;if(typeof this.lastScrollSource==='undefined')this.lastScrollSource=null;this.beginLayout=function c(){this.textDivs=[];this.renderingDone=false;};this.endLayout=function d(){this.layoutDone=true;this.insertDivContent();};this.renderLayer=function e(){var a=this;var c=this.textDivs;var d=this.textContent.bidiTexts;var e=this.textLayerDiv;var f=document.createElement('canvas');var g=f.getContext('2d');var h=100000;if(c.length>h)return;for(var i=0,j=c.length;i<j;i++){var k=c[i];if('isWhitespace' in k.dataset)continue;g.font=k.style.fontSize+' '+k.style.fontFamily;var l=g.measureText(k.textContent).width;if(l>0){b.appendChild(k);var m=k.dataset.canvasWidth/l;var n=k.dataset.angle;var o='scale('+m+', 1)';o='rotate('+n+'deg) '+o;CustomStyle.setProp('transform',k,o);CustomStyle.setProp('transformOrigin',k,'0% 0%');}}e.appendChild(b);this.renderingDone=true;this.updateMatches();};this.setupRenderLayoutTimer=function f(){var a=200;var b=this;var c=this.lastScrollSource===null?0:this.lastScrollSource.lastScroll;if(Date.now()-c>a)this.renderLayer();else{if(this.renderTimer)clearTimeout(this.renderTimer);this.renderTimer=setTimeout(function(){b.setupRenderLayoutTimer();},a);}};this.appendText=function g(a){var b=document.createElement('div');var c=a.fontSize*Math.abs(a.vScale);b.dataset.canvasWidth=a.canvasWidth*Math.abs(a.hScale);b.dataset.fontName=a.fontName;b.dataset.angle=a.angle*(180/Math.PI);b.dataset.bind="highlightedText: { text: text1, highlight: match, css: style }, selectedText: match";b.style.fontSize=c+'px';b.style.fontFamily=a.fontFamily;b.style.left=(a.x+(c*Math.sin(a.angle)))+'px';b.style.top=(a.y-(c*Math.cos(a.angle)))+'px';this.textDivs.push(b);};this.insertDivContent=function h(){if(!this.layoutDone||this.divContentDone||!this.textContent)return;this.divContentDone=true;var a=this.textDivs;var b=this.textContent.bidiTexts;for(var c=0;c<b.length;c++){var d=b[c];var e=a[c];if(!/\S/.test(d.str)){e.dataset.isWhitespace=true;continue;}e.textContent=d.str;e.dir=d.dir;}this.setupRenderLayoutTimer();};this.setTextContent=function i(a){this.textContent=a;this.insertDivContent();};this.convertMatches=function j(a){var b=0;var c=0;var d=this.textContent.bidiTexts;var e=d.length-1;var f=PDFFindController===null?0:PDFFindController.state.query.length;var g=-1;var h;var i=[];for(var j=0;j<a.length;j++){var k=a[j];while(b!==e&&k>=(c+d[b].str.length)){c+=d[b].str.length;b++;}if(b==d.length)console.error('Could not find matching mapping');var l={begin:{divIdx:b,offset:k-c}};k+=f;while(b!==e&&k>(c+d[b].str.length)){c+=d[b].str.length;b++;}l.end={divIdx:b,offset:k-c};i.push(l);}return i;};this.renderMatches=function k(a){if(a.length===0)return;var b=this.textContent.bidiTexts;var c=this.textDivs;var d=null;var e=PDFFindController===null?false:(this.pageIdx===PDFFindController.selected.pageIdx);var f=PDFFindController===null?-1:PDFFindController.selected.matchIdx;var g=PDFFindController===null?false:PDFFindController.state.highlightAll;var h={divIdx:-1,offset:undefined};function i(a,d){var g=a.divIdx;var h=c[g];h.textContent='';var i=b[g].str.substring(0,a.offset);var j=document.createTextNode(i);if(d){var k=e&&g===f;var l=document.createElement('span');l.className=d+(k?' selected':'');l.appendChild(j);h.appendChild(l);return;}h.appendChild(j);}function j(a,d,e){var f=a.divIdx;var g=c[f];var h=b[f].str.substring(a.offset,d.offset);var i=document.createTextNode(h);if(e){var j=document.createElement('span');j.className=e;j.appendChild(i);g.appendChild(j);return;}g.appendChild(i);}function k(a,b){c[a].className=b;}var l=f,m=l+1,n;if(g){l=0;m=a.length;}else if(!e)return;for(n=l;n<m;n++){var o=a[n];var p=o.begin;var q=o.end;var r=e&&n===f;var s=(r?' selected':'');if(r&&!this.isViewerInPresentationMode)scrollIntoView(c[p.divIdx],{top:-50});if(!d||p.divIdx!==d.divIdx){if(d!==null)j(d,h);i(p);}else j(d,p);if(p.divIdx===q.divIdx)j(p,q,'highlight'+s);else{j(p,h,'highlight begin'+s);for(var t=p.divIdx+1;t<q.divIdx;t++)k(t,'highlight middle'+s);i(q,'highlight end'+s);}d=q;}if(d)j(d,h);};this.updateMatches=function l(){if(!this.renderingDone)return;var a=this.matches;var b=this.textDivs;var c=this.textContent.bidiTexts;var d=-1;for(var e=0;e<a.length;e++){var f=a[e];var g=Math.max(d,f.begin.divIdx);for(var h=g;h<=f.end.divIdx;h++){var i=b[h];i.textContent=c[h].str;i.className='';}d=f.end.divIdx+1;}if(PDFFindController===null||!PDFFindController.active)return;this.matches=a=this.convertMatches(PDFFindController===null?[]:(PDFFindController.pageMatches[this.pageIdx]||[]));this.renderMatches(this.matches);};};